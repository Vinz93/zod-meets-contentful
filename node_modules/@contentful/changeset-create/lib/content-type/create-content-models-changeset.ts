import { Changeset } from '@contentful/changeset-types'
import type { ContentTypeProps } from 'contentful-management'
import { createChangesetForEntityCollection } from '../common'

import { contentTypesPatch } from './content-types-patch'
import type { FieldIdMapForAll } from './types'

export function createContentModelsChangeset({
  sourceContentModel,
  targetContentModel,
  fieldIdMapForAll,
}: {
  sourceContentModel: ContentTypeProps[]
  targetContentModel: ContentTypeProps[]
  fieldIdMapForAll: FieldIdMapForAll
}): Changeset<'ContentType'> {
  return createChangesetForEntityCollection({
    itemType: 'ContentType',
    sourceCollection: sourceContentModel,
    targetCollection: targetContentModel,
    createEntityPatch: (sourceEntity, targetEntity) =>
      contentTypesPatch({
        sourceContentType: sourceEntity,
        targetContentType: targetEntity,
        fieldIdMapForAll,
      }),
  })
}
