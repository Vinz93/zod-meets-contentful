# Changeset Create

## About

This is a library for making changeset creation easier. For now it only supports content types but the plan is to extend in the future to also support content.
It's main use right now is in the (merge-app)[https://github.com/contentful/merge-app]

## Pre-Requisites

The library needs a CMA client for some calls

## Installation

```sh
npm install @contentful/changeset-create
```

## Usage

```ts
import { CreateChangeset } from '@contentful/changeset-create'
```

# API

## Content Type

### Load environments and create a changeset

This retrieves the content models and does the id mapping for you. The return is the same as `create`

```ts
const changeset = await CreateChangeset.contentTypes.loadAndCreate({
  clients: {
    sourceEnvironmentClient,
    targetEnvironmentClient,
  },
  spaceId,
  sourceEnvironmentId,
  targetEnvironmentId,
})
```

> we have to provide clients per environment, since app tokens are only scoped to a single environment. When used with a user token, the same client instance can be passed in for both.

### Get the ID mappings

```ts
const fieldIdMapForAll = CreateChangeset.contentTypes.getMapping({
  sourceContentModel,
  targetContentModel,
})
```

### Create a content model change

```ts
const changeset = CreateChangeset.contentTypes.create({
  sourceContentModel,
  targetContentModel,
  fieldIdMapForAll,
})
```

### Get the content model change as `Patch`

```ts
const patch = CreateChangeset.contentTypes.getPatch({
  sourceContentModel,
  targetContentModel,
  fieldIdMapForAll,
})
```

## EditorInterface

The EditorInterface lives on top of the ContentType (endpoint). An EditorInterface entry can only be accessed the ContentType endpoint, or through the EditorInterface collection endpoint. In both cases, The entries do NOT have a public facing sys.id. Instead, they have a contentType link in their sys field.
To associate an EditorInterface Entry with its Content Type, but also to compare to collections, we set EditorInterface `sys.id` to the id of the related content type.

### Create a EditorInterface changeset

```ts
const changeset = await CreateChangeset.editorInterface.create({
  sourceModel,
  targetModel,
})
```

### Load and create a EditorInterface changeset

```ts
const changeset = await CreateChangeset.editorInterface.loadAndCreate({
  clients: {
    sourceEnvironmentClient,
    targetEnvironmentClient,
  },
  spaceId,
  sourceEnvironmentId,
  targetEnvironmentId,
})
```
